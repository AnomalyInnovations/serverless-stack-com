When deploying multiple environments, some into the same AWS account, some across multiple AWS accounts, we need to ensure the resource names do not thrash across environments. For example, in our `checkout-api` service, we have a Lambda function called `checkout`. Now if two developers are working two different features, one deployed to the `featureA` environment and one deploy to the `featureB` environment, and both environments resides in the `Dev` AWS account, only one environment can be successfully deployed. The second environment will get an error indicating a Lambda function with the name `checkout` already exists in this account.

AWS Resources naming need to be unique within a scope, and the scope is different for different resource types. Here are the rules for commonly used serverless resources:

- Unique per account per region: Lambda functions, API Gateway projects, SNS Topic, etc
- Unique per account (across all regions): IAM users/roles
- Unique globally: S3 buckets

The best practice way to ensure uniqueness is by parameterize resource names with the name of the stage. In our example, we can name the Lambda function `checkout-featureA` for the `featureA` stage; `checkout-featureB` for the `featureB` stage; and `checkout-dev` for the `dev` stage.

Luckily, Serverless Framework already parameterizes a few default resources in a service:

- Lambda functions: $serviceName-$stage-$functionName

    ie. post-service-dev-create-post

- API Gateway project: $stage-$serviceName

    ie. dev-post-service

- CloudWatch Log groups: /aws/lambda/$serviceName-$stage-$functionName

    ie. /aws/lambda/post-service-dev-create-post

- IAM roles (for Lambda): $serviceName-$stage-$region-lambdaRole

    ie. post-service-dev-us-east-1-lambdaRole

- S3 bucket (for Serverless Framework to store artifacts): not given a name

    ie. post-service-dev-serverlessdeploymentbucket-3cux6eq6iadj

A couple of things to note here:

- Resource names are parameterize with $serviceName to ensure resource names do not thrash when deploying multiple services
- IAM role name is also parameterized with $region since the name needs to be unique across regions in an account
- S3 bucket is not given a name. When a resource is not unamed, CloudFormation will automatically assign a unique name for it.

We are responsible for parameterizing other resources we define in the serverless.yml.

Here are a couple examples of where parameterization normally happens:

### SNS topic names in function events
```
    ...
    
    custom:
      stage: ${opt:stage, self:provider.stage}
    
    ...
    
    functions:
      dispatcher:
        handler: handler.main
        events:
          - sns: dispatch-${self:custom.stage}
```
### DynamoDB table names in resources
```
    ...
    
    custom:
      stage: ${opt:stage, self:provider.stage}
    
    ...
    
    resources:
    	Resources:
        AppsTable:
          Type: AWS::DynamoDB::Table
          Properties:
            TableName: objects-${self:custom.stage}
            AttributeDefinitions:
              - AttributeName: objectId
                AttributeType: S
            KeySchema:
              - AttributeName: appId
                KeyType: HASH
            BillingMode: 'PAY_PER_REQUEST'
```
### S3 bucket names in resources

Leave the bucket name empty and let CloudFormation auto generate one.
```
    ...
    
    resources:
    	Resources:
        MyBucket:
          Type: AWS::S3::Bucket
```
# Summary

Parameterizing your resources allows your app to be deployed to multiple environments without naming conflict.
